<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recharge</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-image: url('Picsart_25-05-02_01-10-11-004.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      margin: 0;
      padding: 20px;
      user-select: none;
    }

    .container {
      max-width: 480px;
      margin: auto;
      background: rgba(255, 255, 255, 0.92);
      border: 2px solid gold;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      color: goldenrod;
    }

    .note {
      text-align: center;
      color: gray;
      font-size: 14px;
      margin-bottom: 15px;
    }

    label {
      font-weight: bold;
      margin-top: 12px;
      display: block;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .error-message {
      font-size: 13px;
      color: red;
      display: none;
      margin-top: 5px;
    }

    button.submit-btn {
      width: 100%;
      padding: 12px;
      background-color: goldenrod;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      margin-top: 20px;
    }

    .custom-alert {
      padding: 15px;
      margin-top: 15px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: bold;
      text-align: center;
      display: none;
    }

    .alert-success {
      background-color: gold;
      color: black;
    }

    .alert-error {
      background-color: black;
      color: gold;
    }

    #paymentNumber {
      margin-top: 15px;
      padding: 10px;
      background: #fff3cd;
      border-left: 4px solid goldenrod;
      border-radius: 8px;
      display: none;
    }

    #paymentNumber strong {
      display: block;
    }

    .records {
      margin-top: 30px;
    }

    .record-item {
      background-color: #f0f0f0;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
    }

    .record-item span {
      display: block;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Recharge</h2>
    <div class="note">Minimum Recharge: Tzs 10,000</div>

    <label>Phone Number</label>
    <input type="tel" id="phone" placeholder="07XXXXXXXX" maxlength="10" />
    <div id="phoneError" class="error-message">Please enter a valid 10-digit phone number.</div>

    <label>Network</label>
    <select id="network" onchange="showPaymentNumber()">
      <option value="">-- Choose Network --</option>
      <option value="halopesa">Halopesa</option>
      <option value="mpesa">M-Pesa</option>
      <option value="tigopesa">Tigo Pesa</option>
      <option value="airtel">Airtel Money</option>
    </select>

    <div id="paymentNumber"></div>

    <label>Enter Amount (Tzs)</label>
    <input type="number" id="amount" placeholder="e.g. 10000" min="10000" />

    <label>Upload Transaction Screenshot</label>
    <input type="file" id="screenshot" accept="image/*" />
    <div id="screenshotError" class="error-message">Please upload a transaction screenshot.</div>

    <button class="submit-btn" onclick="submitRecharge()">Recharge Now</button>

    <div id="customAlert" class="custom-alert"></div>

    <div class="records">
      <h3>Recharge Records</h3>
    </div>
  </div>

  <script>
    function showCustomAlert(message, isSuccess = true) {
      const alertBox = document.getElementById("customAlert");
      alertBox.textContent = message;
      alertBox.className = `custom-alert ${isSuccess ? 'alert-success' : 'alert-error'}`;
      alertBox.style.display = "block";
      setTimeout(() => alertBox.style.display = "none", 4000);
    }

    function showPaymentNumber() {
      const network = document.getElementById("network").value;
      const paymentDiv = document.getElementById("paymentNumber");

      const namesMap = {
        halopesa: "PHIDEA PHESTON NGOLE",
        mpesa: "MWAJUMA ABDALLA KUFAKWENDA",
        tigopesa: "SOFIA OMARI HAMZA",
        airtel: "JOISI RAULENT RUBEJA"
      };

      const numbers = {
        halopesa: "0610171865",
        mpesa: "0793195313",
        tigopesa: "0775908801",
        airtel: "0697684204"
      };

      if (network && numbers[network]) {
        paymentDiv.innerHTML = `<strong>Payment Number:</strong> ${numbers[network]}<br><strong>Name:</strong> ${namesMap[network]}`;
        paymentDiv.style.display = "block";
      } else {
        paymentDiv.style.display = "none";
      }
    }

    async function submitRecharge() {
      const phone = document.getElementById("phone").value.trim();
      const network = document.getElementById("network").value;
      const amount = parseInt(document.getElementById("amount").value);
      const screenshot = document.getElementById("screenshot").files[0];

      let valid = true;

      if (!/^0\d{9}$/.test(phone)) {
        document.getElementById("phoneError").style.display = "block";
        valid = false;
      } else {
        document.getElementById("phoneError").style.display = "none";
      }

      if (!screenshot) {
        document.getElementById("screenshotError").style.display = "block";
        valid = false;
      } else {
        document.getElementById("screenshotError").style.display = "none";
      }

      if (!network || isNaN(amount) || amount < 10000) {
        showCustomAlert("Please fill all fields correctly (Minimum Tzs 10,000).", false);
        return;
      }

      if (!valid) return;

      const formData = new FormData();
      formData.append("phone", phone);
      formData.append("network", network);
      formData.append("amount", amount);
      formData.append("screenshot", screenshot);

      try {
        const response = await fetch("https://duckfarm-api.up.railway.app/api/recharge", {
          method: "POST",
          body: formData
        });

        if (response.ok) {
          showCustomAlert("Recharge request sent successfully!");
          addRecordToDisplay(phone, network, amount);
          resetForm();
        } else {
          showCustomAlert("Recharge request failed.", false);
        }
      } catch (error) {
        showCustomAlert("Error submitting the form.", false);
      }
    }

    function addRecordToDisplay(phone, network, amount) {
      const recordsDiv = document.querySelector('.records');
      const record = document.createElement('div');
      record.className = "record-item";
      record.innerHTML = `
        <span><strong>Phone:</strong> ${phone}</span>
        <span><strong>Network:</strong> ${network.charAt(0).toUpperCase() + network.slice(1)}</span>
        <span><strong>Amount:</strong> Tzs ${amount.toLocaleString()}</span>
        <span><strong>Screenshot:</strong> Uploaded</span>
      `;
      recordsDiv.appendChild(record);
    }

    function resetForm() {
      document.getElementById("phone").value = "";
      document.getElementById("network").value = "";
      document.getElementById("amount").value = "";
      document.getElementById("screenshot").value = "";
      document.getElementById("paymentNumber").style.display = "none";
    }
  </script>
</body>
</html>